<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiber Network Manager - V4</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-100 text-slate-900">
    
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Plus, Trash2, Download, Upload, Network, Eye, Shuffle, ArrowRightLeft } from 'lucide-react';

        const FiberNetworkManager = () => {
          const [rooms, setRooms] = useState([]);
          const [equipment, setEquipment] = useState([]);
          const [connections, setConnections] = useState([]);
          const [changeLog, setChangeLog] = useState([]);
          const [activeTab, setActiveTab] = useState('rooms');
          const [showDiagram, setShowDiagram] = useState(false);
          const [autoLayout, setAutoLayout] = useState(true);

          // Form states
          const [newRoom, setNewRoom] = useState({ name: '', description: '' });
          const [newEquipment, setNewEquipment] = useState({ 
            name: '', 
            type: 'laser', 
            room: '', 
            description: '' 
          });
          
          const [newConnection, setNewConnection] = useState({
            labelFrom: '',
            labelTo: '',
            fromEquipment: '',
            toEquipment: '',
            fiberType: 'single-mode',
            length: '',
            notes: ''
          });

          const equipmentTypes = [
            'laser', 'multiplexer', 'amplifier', 'white-rabbit', 
            'connection-box', 'splitter', 'user-device', 'other'
          ];

          // --- Actions ---

          const addRoom = () => {
            if (newRoom.name.trim()) {
              const room = { id: Date.now(), ...newRoom, createdAt: new Date().toISOString() };
              setRooms([...rooms, room]);
              logChange('add', 'room', room.name);
              setNewRoom({ name: '', description: '' });
            }
          };

          const addEquipment = () => {
            if (newEquipment.name.trim() && newEquipment.room) {
              const equip = { id: Date.now(), ...newEquipment, createdAt: new Date().toISOString() };
              setEquipment([...equipment, equip]);
              logChange('add', 'equipment', equip.name);
              setNewEquipment({ name: '', type: 'laser', room: '', description: '' });
            }
          };

          const addConnection = () => {
            if ((newConnection.labelFrom.trim() || newConnection.labelTo.trim()) && newConnection.fromEquipment && newConnection.toEquipment) {
              const conn = { id: Date.now(), ...newConnection, createdAt: new Date().toISOString() };
              setConnections([...connections, conn]);
              logChange('add', 'connection', `${newConnection.labelFrom}->${newConnection.labelTo}`);
              setNewConnection({
                labelFrom: '',
                labelTo: '',
                fromEquipment: '',
                toEquipment: '',
                fiberType: 'single-mode',
                length: '',
                notes: ''
              });
            }
          };

          const deleteItem = (type, id, name) => {
            if (type === 'room') {
              setRooms(rooms.filter(r => r.id !== id));
              setEquipment(equipment.filter(e => e.room !== id.toString()));
            } else if (type === 'equipment') {
              setEquipment(equipment.filter(e => e.id !== id));
              setConnections(connections.filter(c => 
                c.fromEquipment !== id.toString() && c.toEquipment !== id.toString()
              ));
            } else if (type === 'connection') {
              setConnections(connections.filter(c => c.id !== id));
            }
            logChange('delete', type, name);
          };

          const logChange = (action, type, item) => {
            const log = {
              id: Date.now(),
              timestamp: new Date().toISOString(),
              action,
              type,
              item
            };
            setChangeLog([log, ...changeLog]);
          };

          // --- Import/Export ---

          const exportData = () => {
            const data = { rooms, equipment, connections, changeLog, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fiber-network-${Date.now()}.json`;
            a.click();
          };

          const importData = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (event) => {
                try {
                  const data = JSON.parse(event.target.result);
                  setRooms(data.rooms || []);
                  setEquipment(data.equipment || []);
                  setConnections(data.connections || []);
                  setChangeLog(data.changeLog || []);
                } catch (error) { alert('Error importing file'); }
              };
              reader.readAsText(file);
            }
          };

          const exportDiagram = () => {
            const svg = document.getElementById('network-diagram');
            if (svg) {
              const svgData = new XMLSerializer().serializeToString(svg);
              const blob = new Blob([svgData], { type: 'image/svg+xml' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `fiber-diagram-${Date.now()}.svg`;
              a.click();
            }
          };

          const getEquipmentName = (id) => equipment.find(e => e.id.toString() === id)?.name || 'Unknown';
          const getRoomName = (id) => rooms.find(r => r.id.toString() === id)?.name || 'Unknown';

          // --- Diagram Component ---

          const NetworkDiagram = () => {
            
            const { sortedRoomKeys, sortedRoomGroups } = useMemo(() => {
                let roomGroups = {};
                rooms.forEach(r => roomGroups[r.id] = []);
                equipment.forEach(e => {
                    if (roomGroups[e.room]) roomGroups[e.room].push(e);
                });

                const roomKeys = Object.keys(roomGroups);

                if (autoLayout) {
                    const roomOrder = [...roomKeys]; 
                    const getConnectedIds = (eqId) => {
                        const peers = [];
                        connections.forEach(c => {
                            if (c.fromEquipment === eqId.toString()) peers.push(c.toEquipment);
                            if (c.toEquipment === eqId.toString()) peers.push(c.fromEquipment);
                        });
                        return peers;
                    };

                    for (let pass = 0; pass < 3; pass++) {
                         roomOrder.forEach((rId, rIdx) => {
                             const roomEquips = roomGroups[rId];
                             const scoredEquips = roomEquips.map((eq, idx) => {
                                 let score = 0;
                                 let count = 0;
                                 const peers = getConnectedIds(eq.id);
                                 peers.forEach(peerId => {
                                     const peerEquip = equipment.find(e => e.id.toString() === peerId);
                                     if (peerEquip) {
                                         if (peerEquip.room !== rId) {
                                            const peerGroup = roomGroups[peerEquip.room];
                                            const peerIndex = peerGroup.indexOf(peerEquip);
                                            if (peerIndex !== -1) {
                                                score += peerIndex; 
                                                count++;
                                            }
                                         }
                                     }
                                 });
                                 const finalScore = count > 0 ? (score / count) : idx;
                                 return { eq, finalScore };
                             });
                             scoredEquips.sort((a, b) => a.finalScore - b.finalScore);
                             roomGroups[rId] = scoredEquips.map(s => s.eq);
                         });
                    }
                }
                return { sortedRoomKeys: roomKeys, sortedRoomGroups: roomGroups };
            }, [rooms, equipment, connections, autoLayout]);

            
            // Dimensions
            const colWidth = 320;
            const width = Math.max(900, sortedRoomKeys.length * colWidth);
            const maxItemsInRoom = Math.max(...Object.values(sortedRoomGroups).map(g => g.length), 0);
            const height = Math.max(600, maxItemsInRoom * 100 + 100);

            // Pre-calc bundling
            const connectionCounts = {};
            connections.forEach(c => {
               const pairKey = [c.fromEquipment, c.toEquipment].sort().join('-');
               connectionCounts[pairKey] = (connectionCounts[pairKey] || 0) + 1;
            });
            const drawnCounts = {};

            const colors = {
                roomBg: '#f1f5f9', 
                roomStroke: '#cbd5e1', 
                roomText: '#334155',
                equipBg: '#ffffff',
                equipStroke: '#475569',
                equipText: '#0f172a', 
                fiberSM: '#2563eb', 
                fiberMM: '#f97316', 
            };

            return (
              <div className="bg-white p-4 rounded border shadow-sm">
                <div className="flex justify-between mb-4 items-center">
                  <h3 className="font-bold text-lg text-slate-700">Network Topology</h3>
                  <div className="flex gap-4">
                      <button 
                        onClick={() => setAutoLayout(!autoLayout)}
                        className={`px-3 py-1 rounded flex items-center gap-2 text-sm font-medium border ${
                            autoLayout ? 'bg-indigo-100 text-indigo-700 border-indigo-200' : 'bg-gray-50 text-gray-600 border-gray-200'
                        }`}
                      >
                        <Shuffle className="w-4 h-4" /> {autoLayout ? 'Auto-Layout On' : 'Auto-Layout Off'}
                      </button>
                      <button onClick={exportDiagram} className="px-3 py-1 bg-slate-600 hover:bg-slate-700 text-white rounded flex items-center gap-2 text-sm">
                        <Download className="w-4 h-4" /> Export SVG
                      </button>
                  </div>
                </div>
                <div className="overflow-auto border rounded bg-slate-50 relative">
                  <svg id="network-diagram" width={width} height={height} className="block">
                    <defs>
                      <marker id="arrowhead-sm" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill={colors.fiberSM} />
                      </marker>
                      <marker id="arrowhead-mm" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill={colors.fiberMM} />
                      </marker>
                      <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="1" dy="1" stdDeviation="2" floodOpacity="0.1"/>
                      </filter>
                    </defs>

                    {sortedRoomKeys.map((roomId, roomIdx) => {
                      const x = roomIdx * colWidth + 50; 
                      const roomEquipment = sortedRoomGroups[roomId];
                      const roomName = getRoomName(roomId);
                      
                      return (
                        <g key={roomId}>
                          {/* Room Container */}
                          <rect x={x} y={40} width={240} height={height - 80} 
                                fill={colors.roomBg} stroke={colors.roomStroke} strokeWidth="1" rx="12"/>
                          <text x={x + 120} y={70} textAnchor="middle" 
                                fontWeight="bold" fontSize="16" fill={colors.roomText} style={{textTransform: 'uppercase', letterSpacing: '1px'}}>
                            {roomName}
                          </text>
                          <line x1={x + 20} y1={85} x2={x + 220} y2={85} stroke={colors.roomStroke} strokeWidth="1" />
                          
                          {/* Equipment */}
                          {roomEquipment.map((equip, idx) => {
                            const equipY = 110 + idx * 90; 
                            const equipX = x + 120;
                            
                            return (
                              <g key={equip.id} style={{cursor: 'default'}}>
                                <rect x={x + 20} y={equipY} width={200} height={60}
                                      fill={colors.equipBg} stroke={colors.equipStroke} strokeWidth="1" rx="6"
                                      filter="url(#shadow)"
                                />
                                <text x={equipX} y={equipY + 25} textAnchor="middle" 
                                      fontSize="13" fontWeight="bold" fill={colors.equipText}>
                                  {equip.name}
                                </text>
                                <text x={equipX} y={equipY + 45} textAnchor="middle" 
                                      fontSize="11" fill="#64748b">
                                  {equip.type}
                                </text>
                                {/* Connector Dots */}
                                <circle cx={x+20} cy={equipY+30} r="3" fill={colors.equipStroke} />
                                <circle cx={x+220} cy={equipY+30} r="3" fill={colors.equipStroke} />
                              </g>
                            );
                          })}
                        </g>
                      );
                    })}
                    
                    {/* Connections Layer */}
                    {connections.map(conn => {
                      const fromEquip = equipment.find(e => e.id.toString() === conn.fromEquipment);
                      const toEquip = equipment.find(e => e.id.toString() === conn.toEquipment);
                      
                      if (fromEquip && toEquip) {
                        const fromRoomIdx = sortedRoomKeys.indexOf(fromEquip.room);
                        const toRoomIdx = sortedRoomKeys.indexOf(toEquip.room);
                        const fromEquipIdx = sortedRoomGroups[fromEquip.room].indexOf(fromEquip);
                        const toEquipIdx = sortedRoomGroups[toEquip.room].indexOf(toEquip);
                        
                        if (fromEquipIdx === -1 || toEquipIdx === -1) return null;

                        // Calculate Offset for bundling
                        const pairKey = [conn.fromEquipment, conn.toEquipment].sort().join('-');
                        const totalInBundle = connectionCounts[pairKey];
                        const currentIdx = drawnCounts[pairKey] || 0;
                        drawnCounts[pairKey] = currentIdx + 1;

                        const spacing = 10;
                        const offset = (currentIdx - (totalInBundle - 1) / 2) * spacing;

                        // Color setup
                        const isMultiMode = conn.fiberType === 'multi-mode';
                        const strokeColor = isMultiMode ? colors.fiberMM : colors.fiberSM;
                        const markerUrl = isMultiMode ? 'url(#arrowhead-mm)' : 'url(#arrowhead-sm)';

                        // === LOGIC SPLIT: SAME ROOM vs DIFFERENT ROOM ===

                        if (fromRoomIdx === toRoomIdx) {
                            // --- SAME ROOM CONNECTION (Loop curve on the right) ---
                            const xBase = fromRoomIdx * colWidth + 50 + 220; // Right edge of box
                            const x1 = xBase;
                            const x2 = xBase;
                            const y1 = 110 + fromEquipIdx * 90 + 30 + offset;
                            const y2 = 110 + toEquipIdx * 90 + 30 + offset;
                            
                            // Control points curve outward to the right
                            const curveDepth = 50 + (Math.abs(y1 - y2) * 0.1); // Dynamic curve width
                            const cpX = xBase + curveDepth;

                            const pathD = `M ${x1} ${y1} C ${cpX} ${y1}, ${cpX} ${y2}, ${x2} ${y2}`;

                            // Labels for same room (positioned at the peak of the curve)
                            const labelX = cpX + 5;
                            const labelY1 = y1 + (y2 - y1) * 0.25;
                            const labelY2 = y1 + (y2 - y1) * 0.75;
                            
                            return (
                                <g key={conn.id} className="connection-group hover:opacity-100 opacity-90 transition-opacity">
                                    <path d={pathD}
                                        stroke={strokeColor} strokeWidth="2" fill="none" markerEnd={markerUrl}
                                        strokeDasharray={conn.length.includes('km') ? "5,5" : "0"} 
                                    />
                                    <text x={labelX} y={labelY1} fontSize="10" fill={strokeColor} fontWeight="bold" fontFamily="monospace">
                                        {conn.labelFrom}
                                    </text>
                                    <text x={labelX} y={labelY2} fontSize="10" fill={strokeColor} fontWeight="bold" fontFamily="monospace">
                                        {conn.labelTo}
                                    </text>
                                </g>
                            );

                        } else {
                            // --- DIFFERENT ROOM CONNECTION (Left to Right) ---
                            const x1 = fromRoomIdx * colWidth + 50 + 220; 
                            const y1 = 110 + fromEquipIdx * 90 + 30 + offset;
                            
                            const x2 = toRoomIdx * colWidth + 50 + 20;
                            const y2 = 110 + toEquipIdx * 90 + 30 + offset;
                            
                            const midX = (x1 + x2) / 2;
                            const isLeftToRight = x2 > x1;

                            // Standard Labels
                            const labelX1 = x1 + (x2 - x1) * 0.15;
                            const labelY1 = y1; 
                            const labelX2 = x1 + (x2 - x1) * 0.85;
                            const labelY2 = y2;

                            return (
                                <g key={conn.id} className="connection-group hover:opacity-100 opacity-90 transition-opacity">
                                    <path d={`M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}`}
                                        stroke={strokeColor} strokeWidth="2" fill="none" markerEnd={markerUrl}
                                        strokeDasharray={conn.length.includes('km') ? "5,5" : "0"} 
                                    />
                                    <text x={labelX1} y={labelY1 - 6} 
                                        textAnchor={isLeftToRight ? "start" : "end"} 
                                        fontSize="10" fill={strokeColor} fontWeight="bold" fontFamily="monospace">
                                    {conn.labelFrom}
                                    </text>
                                    <text x={labelX2} y={labelY2 - 6} 
                                        textAnchor={isLeftToRight ? "end" : "start"} 
                                        fontSize="10" fill={strokeColor} fontWeight="bold" fontFamily="monospace">
                                    {conn.labelTo}
                                    </text>
                                </g>
                            );
                        }
                      }
                      return null;
                    })}
                  </svg>
                </div>
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-slate-100 p-6 text-slate-800 font-sans">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6 border border-slate-200">
                  <div className="flex justify-between items-center mb-6">
                    <div className="flex items-center gap-3">
                      <div className="bg-blue-600 p-2 rounded-lg">
                        <Network className="w-8 h-8 text-white" />
                      </div>
                      <h1 className="text-3xl font-bold text-slate-800">Fiber Network Manager</h1>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={exportData} className="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded shadow-sm flex items-center gap-2 transition-colors">
                        <Download className="w-4 h-4" /> Export JSON
                      </button>
                      <label className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded shadow-sm flex items-center gap-2 cursor-pointer transition-colors">
                        <Upload className="w-4 h-4" /> Import JSON
                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                      </label>
                      <button 
                        onClick={() => setShowDiagram(!showDiagram)} 
                        className="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded shadow-sm flex items-center gap-2 transition-colors">
                        <Eye className="w-4 h-4" /> {showDiagram ? 'Hide' : 'Show'} Diagram
                      </button>
                    </div>
                  </div>

                  {showDiagram && <NetworkDiagram />}

                  <div className="border-b border-slate-200 mb-6">
                    <div className="flex gap-6">
                      {['rooms', 'equipment', 'connections', 'changelog'].map(tab => (
                        <button
                          key={tab}
                          onClick={() => setActiveTab(tab)}
                          className={`px-2 py-3 font-medium transition-colors border-b-2 ${
                            activeTab === tab
                              ? 'border-blue-600 text-blue-600'
                              : 'border-transparent text-slate-500 hover:text-slate-800'
                          }`}
                        >
                          {tab.charAt(0).toUpperCase() + tab.slice(1)}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* ROOMS TAB */}
                  {activeTab === 'rooms' && (
                    <div className="animate-fade-in">
                      <div className="bg-slate-50 p-5 rounded-lg border border-slate-200 mb-6">
                        <h3 className="font-semibold mb-3 text-slate-700">Add New Room</h3>
                        <div className="grid grid-cols-2 gap-4 mb-3">
                          <input
                            type="text"
                            placeholder="Room name (e.g. Server Room A)"
                            value={newRoom.name}
                            onChange={(e) => setNewRoom({ ...newRoom, name: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                          <input
                            type="text"
                            placeholder="Description"
                            value={newRoom.description}
                            onChange={(e) => setNewRoom({ ...newRoom, description: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                        </div>
                        <button onClick={addRoom} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded flex items-center gap-2">
                          <Plus className="w-4 h-4" /> Create Room
                        </button>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {rooms.map(room => (
                          <div key={room.id} className="bg-white border rounded-lg p-4 flex justify-between items-center shadow-sm">
                            <div>
                              <div className="font-bold text-lg">{room.name}</div>
                              <div className="text-sm text-slate-500">{room.description}</div>
                            </div>
                            <button onClick={() => deleteItem('room', room.id, room.name)} 
                                    className="text-red-500 hover:bg-red-50 p-2 rounded transition-colors">
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* EQUIPMENT TAB */}
                  {activeTab === 'equipment' && (
                    <div className="animate-fade-in">
                      <div className="bg-slate-50 p-5 rounded-lg border border-slate-200 mb-6">
                        <h3 className="font-semibold mb-3 text-slate-700">Add Equipment</h3>
                        <div className="grid grid-cols-2 gap-4 mb-3">
                          <input
                            type="text"
                            placeholder="Equipment name"
                            value={newEquipment.name}
                            onChange={(e) => setNewEquipment({ ...newEquipment, name: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                          <select
                            value={newEquipment.type}
                            onChange={(e) => setNewEquipment({ ...newEquipment, type: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none bg-white"
                          >
                            {equipmentTypes.map(type => (
                              <option key={type} value={type}>{type}</option>
                            ))}
                          </select>
                          <select
                            value={newEquipment.room}
                            onChange={(e) => setNewEquipment({ ...newEquipment, room: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none bg-white"
                          >
                            <option value="">Select room</option>
                            {rooms.map(room => (
                              <option key={room.id} value={room.id}>{room.name}</option>
                            ))}
                          </select>
                          <input
                            type="text"
                            placeholder="Description"
                            value={newEquipment.description}
                            onChange={(e) => setNewEquipment({ ...newEquipment, description: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                        </div>
                        <button onClick={addEquipment} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded flex items-center gap-2">
                          <Plus className="w-4 h-4" /> Add Equipment
                        </button>
                      </div>
                      <div className="space-y-2">
                        {equipment.map(equip => (
                          <div key={equip.id} className="bg-white border rounded-lg p-4 flex justify-between items-center shadow-sm">
                            <div>
                              <div className="font-bold">{equip.name}</div>
                              <div className="text-sm text-slate-500 flex items-center gap-2">
                                <span className="px-2 py-0.5 bg-slate-100 rounded text-xs uppercase font-semibold">{equip.type}</span>
                                <span>in {getRoomName(equip.room)}</span>
                                <span className="text-slate-400">•</span>
                                <span>{equip.description}</span>
                              </div>
                            </div>
                            <button onClick={() => deleteItem('equipment', equip.id, equip.name)} 
                                    className="text-red-500 hover:bg-red-50 p-2 rounded transition-colors">
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* CONNECTIONS TAB */}
                  {activeTab === 'connections' && (
                    <div className="animate-fade-in">
                      <div className="bg-slate-50 p-5 rounded-lg border border-slate-200 mb-6">
                         <h3 className="font-semibold mb-3 text-slate-700">Add Connection</h3>
                        <div className="grid grid-cols-2 gap-4 mb-3">
                           <div className="flex gap-2">
                             <input
                              type="text"
                              placeholder="Label (Source)"
                              value={newConnection.labelFrom}
                              onChange={(e) => setNewConnection({ ...newConnection, labelFrom: e.target.value })}
                              className="px-4 py-2 border rounded w-full focus:ring-2 focus:ring-blue-200 outline-none"
                            />
                            <input
                              type="text"
                              placeholder="Label (Dest)"
                              value={newConnection.labelTo}
                              onChange={(e) => setNewConnection({ ...newConnection, labelTo: e.target.value })}
                              className="px-4 py-2 border rounded w-full focus:ring-2 focus:ring-blue-200 outline-none"
                            />
                          </div>
                          <select
                            value={newConnection.fiberType}
                            onChange={(e) => setNewConnection({ ...newConnection, fiberType: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none bg-white"
                          >
                            <option value="single-mode">Single-mode (Blue)</option>
                            <option value="multi-mode">Multi-mode (Orange)</option>
                          </select>
                          <select
                            value={newConnection.fromEquipment}
                            onChange={(e) => setNewConnection({ ...newConnection, fromEquipment: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none bg-white"
                          >
                            <option value="">From equipment</option>
                            {equipment.map(equip => (
                              <option key={equip.id} value={equip.id}>
                                {equip.name} ({getRoomName(equip.room)})
                              </option>
                            ))}
                          </select>
                          <select
                            value={newConnection.toEquipment}
                            onChange={(e) => setNewConnection({ ...newConnection, toEquipment: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none bg-white"
                          >
                            <option value="">To equipment</option>
                            {equipment.map(equip => (
                              <option key={equip.id} value={equip.id}>
                                {equip.name} ({getRoomName(equip.room)})
                              </option>
                            ))}
                          </select>
                          <input
                            type="text"
                            placeholder="Length (e.g., 50m)"
                            value={newConnection.length}
                            onChange={(e) => setNewConnection({ ...newConnection, length: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                          <input
                            type="text"
                            placeholder="Notes"
                            value={newConnection.notes}
                            onChange={(e) => setNewConnection({ ...newConnection, notes: e.target.value })}
                            className="px-4 py-2 border rounded focus:ring-2 focus:ring-blue-200 outline-none"
                          />
                        </div>
                        <button onClick={addConnection} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded flex items-center gap-2">
                          <Plus className="w-4 h-4" /> Add Connection
                        </button>
                      </div>
                      <div className="space-y-2">
                        {connections.map(conn => (
                          <div key={conn.id} className="bg-white border rounded-lg p-4 flex justify-between items-center shadow-sm">
                            <div>
                              <div className="font-bold flex gap-2 items-center">
                                <span className={`px-2 py-0.5 rounded text-xs text-white uppercase ${conn.fiberType === 'multi-mode' ? 'bg-orange-500' : 'bg-blue-600'}`}>
                                    {conn.fiberType === 'multi-mode' ? 'MM' : 'SM'}
                                </span>
                                <span className="text-slate-800">{conn.labelFrom || conn.label}</span>
                                <ArrowRightLeft className="w-3 h-3 text-slate-400" />
                                <span className="text-slate-800">{conn.labelTo || conn.label}</span>
                              </div>
                              <div className="text-sm text-slate-600 mt-1">
                                {getEquipmentName(conn.fromEquipment)} → {getEquipmentName(conn.toEquipment)}
                              </div>
                              <div className="text-xs text-slate-400 mt-0.5">
                                Length: {conn.length} • {conn.notes}
                              </div>
                            </div>
                            <button onClick={() => deleteItem('connection', conn.id, conn.labelFrom)} 
                                    className="text-red-500 hover:bg-red-50 p-2 rounded transition-colors">
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* CHANGELOG TAB */}
                  {activeTab === 'changelog' && (
                    <div className="animate-fade-in">
                      <h2 className="text-xl font-bold mb-4 text-slate-800">Change Log</h2>
                      <div className="space-y-2">
                        {changeLog.map(log => (
                          <div key={log.id} className="bg-white border rounded-lg p-3 text-sm">
                            <div className="flex justify-between">
                              <div>
                                <span className={`font-bold capitalize ${log.action === 'add' ? 'text-green-600' : 'text-red-600'}`}>
                                    {log.action.toUpperCase()}
                                </span>
                                <span className="mx-2 text-slate-300">|</span>
                                <span className="text-slate-700 font-medium">{log.type}</span>
                                <span className="mx-2 text-slate-300">|</span>
                                <span className="text-slate-600">{log.item}</span>
                              </div>
                              <div className="text-slate-400 text-xs">
                                {new Date(log.timestamp).toLocaleString()}
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<FiberNetworkManager />);

    </script>
</body>
</html>
